# Anti-Func WordPress Plugin

**Plugin Name:** Anti-Func
**Description:** Anti-Func - это мощный многофункциональный плагин для WordPress, который заменяет необходимость редактирования файла functions.php. Плагин предоставляет более 30 полезных функций для оптимизации, безопасности и улучшения вашего сайта.
**Author:** Robert Bennett
**Plugin URI:** https://github.com/RobertoBennett/anti-func
**Version:** 3.0.7
**Text Domain:** Anti-Func

---

## Описание

Anti-Func - это комплексный плагин для WordPress, разработанный для расширения функциональности вашего сайта без прямого редактирования файла `functions.php`. Он предлагает широкий спектр инструментов для оптимизации, повышения безопасности и улучшения пользовательского опыта. Этот плагин особенно полезен для разработчиков, которым нужен безопасный способ добавления кастомного функционала, минимизируя риск поломки сайта.

## Основные возможности

*   **Управление скриптами и стилями:** Оптимизация загрузки ресурсов.
*   **Кастомизация административной панели:** Настройка внешнего вида и функционала админ-панели.
*   **Система контроля доступа и регистрации:** Улучшенное управление пользователями и регистрацией.
*   **Оптимизация SEO и метаданных:** Инструменты для улучшения поисковой выдачи.
*   **Инструменты для работы с пользователями:** Расширенные возможности управления пользовательскими данными.
*   **Шорткоды для различного функционала:** Удобное добавление кастомных элементов на страницы.
*   **Система мониторинга посетителей:** Отслеживание активности пользователей и ботов.
*   **Защита от спама и ботов:** Меры по предотвращению нежелательной активности.

## Установка

1.  Загрузите плагин через панель администратора WordPress (`Плагины > Добавить новый > Загрузить плагин`) или загрузите файлы плагина в директорию `wp-content/plugins/`.
2.  Активируйте плагин через меню "Плагины" в WordPress.

## Функции и использование

### 1. Автоматическое перенаправление после входа

Перенаправляет авторизованных пользователей на страницу администратора (`admin_url()`) при попытке доступа к `wp-login.php`.

### 2. Управление HLS.js

Автоматически отключает и повторно подключает скрипт `hls.js` только на страницах, содержащих шорткод `[m3u_player]`, для оптимизации производительности.

### 3. Центрирование шорткодов

Предоставляет шорткоды для центрирования контента:

*   `[center]Ваш контент[/center]` - Центрирует контент с использованием `display: flex`.
*   `[center_block width="auto"]Ваш контент[/center_block]` - Центрирует блочный контент с использованием `display: block` и `text-align: center`. Параметр `width` позволяет задать ширину блока.

### 4. Удаление ненужных мета-тегов и ссылок

Удаляет из `<head>` следующие элементы для улучшения безопасности и чистоты кода:

*   `wp_generator`
*   `wlwmanifest_link`
*   `rsd_link`
*   `wp_shortlink_wp_head`
*   `adjacent_posts_rel_link_wp_head`

### 5. Удаление Emoji скриптов и стилей

Полностью отключает скрипты и стили Emoji, что может улучшить скорость загрузки страницы.

### 6. Ленивая загрузка для списков постов

Добавляет JavaScript для реализации ленивой загрузки элементов с классом `.lazy-post` с использованием `IntersectionObserver`. Требует наличия функции `loadPostContent`.

### 7. Кэширование фрагментов с большим количеством DOM

Функция `cached_widget_output` кэширует HTML-вывод виджетов, упрощая их структуру для кэширования.

### 8. Очистка просроченных Transient

Ежедневно запускает задачу по очистке устаревших записей `transient` из базы данных WordPress, помогая поддерживать чистоту и производительность.

### 9. Отключение специфических опций

Автоматически отключает ряд опций плагинов, которые могут быть нежелательны или вызывать конфликты. Список опций:
`grassblade_free_addons`, `grassblade_addons`, `ampforwppro_license_info`, `wpfucf_custom_fields`, `cmplz_transients`, `aioseo_options`, `anspress_opt`, `wpforo_attach_phrases`, `joli_table_of_contents_settings`, `aioseo_options_dynamic`, `wpforo_attach_options`, `wpforo_subscriptions`, `simple_gdpr_cookie_compliance_options`, `wpforo_email`, `foxiz_import_id`, `amp-wp-translation`, `wbcr_clearfy_hidden_notices`, `kahuna_settings`, `hu_theme_options`.

### 10. Блокировка специфических Email и доменов

Предотвращает регистрацию пользователей с определенных адресов электронной почты (`info203@noreply0.com`, `sinfo100@2-construction.store`) и доменов, указанных в файле `blocked-domains.txt` в корневой директории WordPress.

### 11. Добавление номера страницы в метаданные

Добавляет номер текущей страницы к мета-описанию (`wpseo_metadesc`) и заголовку (`wpseo_title`) для страниц пагинации.

### 12. Удаление слова "Рубрика" из заголовков архивов

Удаляет префикс "Рубрика:" и "Метка:" из заголовков страниц категорий и меток.

### 13. Создание желтого блока через шорткод

Шорткод `[yellowbox]Ваш контент[/yellowbox]` создает стилизованный желтый блок для выделения текста.

### 14. Установка тайм-аута сессии

Устанавливает время жизни cookie-файлов сессии для обычных пользователей в 14400 секунд (4 часа), а для администраторов - в 315360000 секунд (10 лет).

### 15. Уникальные Description на страницах пагинации

Удаляет стандартные мета-описания от SEO-плагинов на страницах пагинации и генерирует уникальное описание, включающее номер страницы, описание категории (или стандартное описание) и название сайта.

### 16. Функционал "Кто онлайн"

Отслеживает и отображает информацию о текущих посетителях сайта (пользователях, гостях, ботах) с их IP-адресами, хостнеймами и провайдерами.
Используйте шорткод `[online_users]` для отображения списка онлайн-пользователей.
Ведет логи уникальных посещений в директории `ABSPATH/online_logs/`.

### 17. Функционал статистики посетителей

Предоставляет статистику посещений сайта за последние 7, 14 и 30 дней, включая количество ботов, поисковых ботов, зарегистрированных пользователей и гостей. Также детализирует визиты поисковых ботов.
Используйте шорткод `[visitors_stats]` для отображения этой статистики.

### 18. Вывод списка зарегистрированных пользователей

Отображает список всех зарегистрированных пользователей (кроме администраторов) с их именем, скрытым email, датой регистрации и датой последнего входа.
Используйте шорткод `[registered_users]` для отображения списка.

### 19. Генерация уникальных имен файлов при загрузке

Изменяет имена загружаемых файлов на уникальные идентификаторы, чтобы избежать конфликтов и улучшить безопасность.

### 20. Шорткод для скрытия контента

Шорткод `[restricted]Ваш контент[/restricted]` скрывает контент от незарегистрированных пользователей, предлагая им войти или зарегистрироваться.

### 21. Шорткод для вывода статистики сайта

Шорткод `[site_stats]` отображает общую статистику сайта, такую как количество записей, страниц, рубрик, меток и комментариев. Параметры `show_posts`, `show_pages`, `show_categories`, `show_tags`, `show_comments` позволяют включать/отключать отображение конкретных метрик.

### 22. Шорткод "Последнее обновление"

Шорткод `[last_update]` отображает текущую дату как дату последнего обновления.

### 23. Кастомизация страницы входа

Изменяет логотип и цвет фона на странице входа WordPress. Логотип устанавливается на `https://sexandrelationships.ru/wp-content/uploads/2024/07/2be1gxdf208f.webp`, а фон - на `#f0f0f0`.

### 24. Шорткод для прокручиваемого списка с поиском

Шорткод `[scrolling_list items="Элемент 1, Элемент 2, Элемент 3" height="200px"]` создает прокручиваемый список с полем поиска.

### 25. Измерение времени загрузки страницы

*   Шорткод `[page_load_time]` отображает время загрузки текущей страницы в секундах.
*   Шорткод `[page_size]` отображает размер контента страницы в килобайтах.

### 26. Получение информации о посетителе

Шорткод `[visitor_info]` отображает информацию о текущем посетителе, включая IP-адрес, страну, город, координаты, операционную систему и браузер. Использует внешние API для определения геолокации.

### 27. Шорткод для случайной цитаты

Шорткод `[random_quote]` отображает случайную цитату из файла `quotes.txt`, расположенного в директории вашей темы.

### 28. Запрет множественных регистраций с одного IP

Предотвращает регистрацию нескольких учетных записей с одного и того же IP-адреса.

### 29. Запись времени входа пользователя

Записывает время последнего и предыдущего входа пользователя в метаданные пользователя.

### 30. Информация о времени входа в админ-бар

Добавляет в админ-бар WordPress пункт меню, отображающий время текущего и предыдущего входа для авторизованного пользователя.

---

## Разработка

Плагин разработан Робертом Беннеттом.
Исходный код доступен на GitHub: [https://github.com/RobertoBennett/anti-func](https://github.com/RobertoBennett/anti-func)

---

## Лицензия

Этот плагин распространяется под открытой лицензией.
